{% extends "base.html" %}
{% block title %}Expenses - PinkLedger{% endblock %}

{% block content %}
<div class="card">
  <div class="section-header">
    <div>
      <div class="section-title">
        <span class="section-icon" aria-hidden="true">
          <svg viewBox="0 0 24 24">
            <path d="M12 20V8" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
            <path d="M17 13l-5-5-5 5" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </span>
        <h2>Expenses</h2>
      </div>
      <p class="muted section-subtitle">Track spending by category and date.</p>
    </div>
    <span class="card-pill">Overview</span>
  </div>
</div>

<div class="card">
  <div class="card-header">
    <div class="card-title">
      <span class="card-icon" aria-hidden="true">
        <svg viewBox="0 0 24 24">
          <path d="M12 5v14M5 12h14" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
        </svg>
      </span>
      <h3>Add Expense</h3>
    </div>
    <span class="card-pill">Form</span>
  </div>
  <form method="post" action="{{ url_for('finance.add_expense') }}">
    {{ csrf_token() if csrf_token is defined }}
    <label>Amount</label>
    <input class="input" type="number" name="amount" step="0.01" required>
    <label>Category</label>
    <div class="category-grid" role="radiogroup" aria-label="Expense category">
      <label class="category-option">
        <input type="radio" name="category" value="Food" required>
        <span class="category-icon" aria-hidden="true">
          <svg viewBox="0 0 24 24">
            <path d="M7 3v9M11 3v9M15 4v8" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
            <path d="M6 12h10v5a3 3 0 0 1-3 3H9a3 3 0 0 1-3-3z" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linejoin="round"/>
            <path d="M18 9c2 0 2 3 0 3" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
          </svg>
        </span>
        <span class="category-label">Food</span>
      </label>
      <label class="category-option">
        <input type="radio" name="category" value="Travel">
        <span class="category-icon" aria-hidden="true">
          <svg viewBox="0 0 24 24">
            <path d="M3 12h18" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
            <path d="M5 12l3-6h8l3 6" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linejoin="round"/>
            <path d="M7 12l2 7M17 12l-2 7" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
          </svg>
        </span>
        <span class="category-label">Travel</span>
      </label>
      <label class="category-option">
        <input type="radio" name="category" value="Shopping">
        <span class="category-icon" aria-hidden="true">
          <svg viewBox="0 0 24 24">
            <path d="M6 8h12l-1.2 10.5a2 2 0 0 1-2 1.5H9.2a2 2 0 0 1-2-1.5z" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linejoin="round"/>
            <path d="M9 8a3 3 0 0 1 6 0" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
          </svg>
        </span>
        <span class="category-label">Shopping</span>
      </label>
      <label class="category-option">
        <input type="radio" name="category" value="Bills">
        <span class="category-icon" aria-hidden="true">
          <svg viewBox="0 0 24 24">
            <path d="M6 3h9l3 3v15H6z" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linejoin="round"/>
            <path d="M9 11h6M9 15h6" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
          </svg>
        </span>
        <span class="category-label">Bills</span>
      </label>
      <label class="category-option">
        <input type="radio" name="category" value="Others">
        <span class="category-icon" aria-hidden="true">
          <svg viewBox="0 0 24 24">
            <path d="M12 4v16M4 12h16" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
            <path d="M7 7l10 10" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
          </svg>
        </span>
        <span class="category-label">Others</span>
      </label>
    </div>
    <label>Date</label>
    <input class="input" type="date" name="date" value="{{ today }}" required>
    <button class="btn btn-primary" type="submit">Add Expense</button>
  </form>
</div>

<div class="card">
  <div class="card-header">
    <div class="card-title">
      <span class="card-icon" aria-hidden="true">
        <svg viewBox="0 0 24 24">
          <path d="M6 7h12M6 12h12M6 17h8" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
        </svg>
      </span>
      <h3>Expense List</h3>
    </div>
    <span class="card-pill">Latest</span>
  </div>
  <table class="table">
    <thead>
      <tr>
        <th>Date</th>
        <th>Category</th>
        <th>Amount</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      {% for exp in expenses %}
      <tr>
        <td>{{ exp.date }}</td>
        <td>{{ exp.category or 'Other' }}</td>
        <td>â‚± {{ exp.amount }}</td>
        <td>
          <button class="btn btn-secondary js-delete-expense" data-id="{{ exp.id }}" type="button">Delete</button>
        </td>
      </tr>
      {% else %}
      <tr>
        <td colspan="4" class="muted">No expenses recorded yet.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('click', function (event) {
  const btn = event.target.closest('.js-delete-expense');
  if (!btn) return;
  const id = btn.getAttribute('data-id');
  if (!id) return;
  if (!window.confirm('Delete this expense entry?')) return;
  fetch(`/finance/expense/${id}`, { method: 'DELETE' })
    .then(res => res.ok ? window.location.reload() : alert('Delete failed'))
    .catch(() => alert('Delete failed'));
});
</script>
{% endblock %}
