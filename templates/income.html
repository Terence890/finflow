{% extends "base.html" %}
{% block title %}Income - PinkLedger{% endblock %}

{% block content %}
<div class="card">
  <div class="section-header">
    <div>
      <div class="section-title">
        <span class="section-icon" aria-hidden="true">
          <svg viewBox="0 0 24 24">
            <path d="M12 4v12" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
            <path d="M7 11l5 5 5-5" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </span>
        <h2>Income</h2>
      </div>
      <p class="muted section-subtitle">Track your income sources and amounts.</p>
    </div>
    <span class="card-pill">Overview</span>
  </div>
</div>

<div class="card">
  <div class="card-header">
    <div class="card-title">
      <span class="card-icon" aria-hidden="true">
        <svg viewBox="0 0 24 24">
          <path d="M12 5v14M5 12h14" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
        </svg>
      </span>
      <h3>Add Income</h3>
    </div>
    <span class="card-pill">Form</span>
  </div>
  <form method="post" action="{{ url_for('finance.add_income') }}">
    {{ csrf_token() if csrf_token is defined }}
    <label>Amount</label>
    <input class="input" type="number" name="amount" step="0.01" required>
    <label>Source</label>
    <input class="input" type="text" name="source" required>
    <label>Date</label>
    <input class="input" type="date" name="date" value="{{ today }}" required>
    <button class="btn btn-primary" type="submit">Add Income</button>
  </form>
</div>

<div class="card">
  <div class="card-header">
    <div class="card-title">
      <span class="card-icon" aria-hidden="true">
        <svg viewBox="0 0 24 24">
          <path d="M6 7h12M6 12h12M6 17h8" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
        </svg>
      </span>
      <h3>Income List</h3>
    </div>
    <span class="card-pill">Latest</span>
  </div>
  <table class="table">
    <thead>
      <tr>
        <th>Date</th>
        <th>Source</th>
        <th>Amount</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      {% for inc in incomes %}
      <tr>
        <td>{{ inc.date }}</td>
        <td>{{ inc.source or 'Income' }}</td>
        <td>â‚± {{ inc.amount }}</td>
        <td>
          <button class="btn btn-secondary js-delete-income" data-id="{{ inc.id }}" type="button">Delete</button>
        </td>
      </tr>
      {% else %}
      <tr>
        <td colspan="4" class="muted">No income recorded yet.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('click', function (event) {
  const btn = event.target.closest('.js-delete-income');
  if (!btn) return;
  const id = btn.getAttribute('data-id');
  if (!id) return;
  if (!window.confirm('Delete this income entry?')) return;
  fetch(`/finance/income/${id}`, { method: 'DELETE' })
    .then(res => res.ok ? window.location.reload() : alert('Delete failed'))
    .catch(() => alert('Delete failed'));
});
</script>
{% endblock %}
